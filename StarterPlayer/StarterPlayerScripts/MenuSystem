local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ==============================================================================
-- [ë°ì´í„° ì„¤ì •] ì„ì‹œ ì•„ì´í…œ ë° ìŠ¤íƒ¯ ë°ì´í„°
-- ==============================================================================
local myStats = {
	Level = 1,
	Gold = 200,
	Attack = 10,
	Health = 100,
	Defense = 5
}

-- ì•„ì´í…œ ëª©ë¡ (í…ŒìŠ¤íŠ¸ìš©)
local inventoryData = {
	{ id = 1, name = "Iron Sword", type = "Weapon", stat = "ATK +5", value = 5, icon = "âš”ï¸" },
	{ id = 2, name = "Wood Shield", type = "Shield", stat = "DEF +3", value = 3, icon = "ğŸ›¡ï¸" },
	{ id = 3, name = "Leather Armor", type = "Body", stat = "HP +20", value = 20, icon = "ğŸ‘•" },
	{ id = 4, name = "Iron Helm", type = "Head", stat = "HP +10", value = 10, icon = "ğŸª–" },
	{ id = 5, name = "Speed Boots", type = "Shoes", stat = "SPD +2", value = 2, icon = "ğŸ‘¢" },
	{ id = 6, name = "Fire Ball", type = "Special", stat = "SPC +10", value = 10, icon = "ğŸ”¥" },
    { id = 7, name = "Potion", type = "Consumable", stat = "HP +50", value = 50, icon = "ğŸ§ª" },
}

-- í˜„ì¬ ì¥ì°©ëœ ì•„ì´í…œ
local equippedData = {
	Head = nil,
	Weapon = nil,
	Body = nil,
	Shield = nil,
	Shoes = nil,
	Special = nil
}

-- ==============================================================================
-- [UI ìƒì„±] ë°˜ì‘í˜•(Scale) ë””ìì¸ ì ìš©
-- ==============================================================================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GameMenuUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- 1. ë©”ë‰´ ë²„íŠ¼ (í™”ë©´ ì™¼ìª½)
local menuButton = Instance.new("TextButton")
menuButton.Name = "MenuButton"
menuButton.Size = UDim2.new(0.08, 0, 0.1, 0) 
menuButton.Position = UDim2.new(0.02, 0, 0.5, 0) 
menuButton.AnchorPoint = Vector2.new(0, 0.5) 
menuButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
menuButton.Text = "MENU"
menuButton.TextColor3 = Color3.fromRGB(255, 255, 255)
menuButton.Font = Enum.Font.GothamBold
menuButton.TextScaled = true 
menuButton.Parent = screenGui

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0.2, 0) 
btnCorner.Parent = menuButton

local btnAspect = Instance.new("UIAspectRatioConstraint")
btnAspect.AspectRatio = 1 
btnAspect.Parent = menuButton

local btnStroke = Instance.new("UIStroke")
btnStroke.Thickness = 2
btnStroke.Color = Color3.fromRGB(255, 255, 255)
btnStroke.Parent = menuButton

-- 2. ë©”ì¸ í”„ë ˆì„ (ì „ì²´ ì°½)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0.6, 0, 0.6, 0) 
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5) 
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Visible = false 
mainFrame.Parent = screenGui

local mainAspect = Instance.new("UIAspectRatioConstraint")
mainAspect.AspectRatio = 1.55
mainAspect.Parent = mainFrame

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0.03, 0)
mainCorner.Parent = mainFrame

local mainStroke = Instance.new("UIStroke")
mainStroke.Thickness = 3
mainStroke.Color = Color3.fromRGB(0, 0, 0)
mainStroke.Parent = mainFrame

local dragDetector = Instance.new("UIDragDetector")
dragDetector.Parent = mainFrame

-- 2-1. ì¸ë²¤í† ë¦¬ ì„¹ì…˜ (ì™¼ìª½)
local invSection = Instance.new("Frame")
invSection.Name = "InventorySection"
invSection.Size = UDim2.new(0.55, 0, 0.85, 0) 
invSection.Position = UDim2.new(0.03, 0, 0.05, 0)
invSection.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
invSection.Parent = mainFrame

local invCorner = Instance.new("UICorner")
invCorner.CornerRadius = UDim.new(0.02, 0)
invCorner.Parent = invSection

local invGrid = Instance.new("ScrollingFrame")
invGrid.Size = UDim2.new(0.95, 0, 0.95, 0)
invGrid.Position = UDim2.new(0.025, 0, 0.025, 0)
invGrid.BackgroundTransparency = 1
invGrid.ScrollBarThickness = 6
-- [ìˆ˜ì •ë¨] ìŠ¤í¬ë¡¤ì´ ìë™ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ë„ë¡ ì„¤ì • (ì¤‘ìš”)
invGrid.AutomaticCanvasSize = Enum.AutomaticSize.Y
invGrid.CanvasSize = UDim2.new(0, 0, 0, 0) 
invGrid.Parent = invSection

local gridLayout = Instance.new("UIGridLayout")
gridLayout.Parent = invGrid

-- [ì¤‘ìš” ìˆ˜ì •] ì…€ í¬ê¸°ë¥¼ 'í”½ì…€(Offset)'ë¡œ ê°•ì œ ê³ ì •í•˜ëŠ” í•¨ìˆ˜
local function updateGrid()
	local gridWidth = invGrid.AbsoluteSize.X
	if gridWidth <= 0 then return end

	-- í•œ ì¤„ì— 5ê°œ ë“¤ì–´ê°€ë„ë¡ ê³„ì‚° (ê°€ë¡œì˜ 18% ì •ë„ í¬ê¸°)
	local sizePx = gridWidth * 0.18
	local paddingPx = gridWidth * 0.015
	
	-- X, Y ëª¨ë‘ í”½ì…€(Offset)ë¡œ ì„¤ì • -> ì ˆëŒ€ ì°Œê·¸ëŸ¬ì§€ì§€ ì•ŠìŒ
	gridLayout.CellSize = UDim2.new(0, sizePx, 0, sizePx)
	gridLayout.CellPadding = UDim2.new(0, paddingPx, 0, paddingPx)
end

-- í™”ë©´ í¬ê¸°ê°€ ë°”ë€” ë•Œë§ˆë‹¤ ì‹¤í–‰
invGrid:GetPropertyChangedSignal("AbsoluteSize"):Connect(updateGrid)

-- 2-2. ì¥ë¹„ & ìŠ¤íƒ¯ ì„¹ì…˜ (ì˜¤ë¥¸ìª½)
local equipSection = Instance.new("Frame")
equipSection.Name = "EquipSection"
equipSection.Size = UDim2.new(0.38, 0, 0.7, 0) 
equipSection.Position = UDim2.new(0.6, 0, 0.05, 0)
equipSection.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
equipSection.Parent = mainFrame

local equipCorner = Instance.new("UICorner")
equipCorner.CornerRadius = UDim.new(0.02, 0)
equipCorner.Parent = equipSection

local slotSize = UDim2.new(0.25, 0, 0.25, 0) 

local slots = {
    {Name="Head", Pos=UDim2.new(0.5, 0, 0.12, 0), Icon="ğŸª–"},
    {Name="Weapon", Pos=UDim2.new(0.2, 0, 0.42, 0), Icon="âš”ï¸"},
    {Name="Body", Pos=UDim2.new(0.5, 0, 0.42, 0), Icon="ğŸ‘•"},
    {Name="Shield", Pos=UDim2.new(0.8, 0, 0.42, 0), Icon="ğŸ›¡ï¸"},
    {Name="Shoes", Pos=UDim2.new(0.35, 0, 0.72, 0), Icon="ğŸ‘¢"},
    {Name="Special", Pos=UDim2.new(0.65, 0, 0.72, 0), Icon="âœ¨"},
}

local equipButtons = {} 

for _, s in ipairs(slots) do
    local slotBtn = Instance.new("TextButton")
    slotBtn.Name = s.Name
    slotBtn.Size = slotSize
    slotBtn.Position = s.Pos
    slotBtn.AnchorPoint = Vector2.new(0.5, 0) 
    slotBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    slotBtn.Text = s.Icon .. "\n" .. s.Name
    slotBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    slotBtn.Font = Enum.Font.GothamBold
    slotBtn.TextScaled = true 
    slotBtn.Parent = equipSection
    
    local sc = Instance.new("UICorner")
    sc.CornerRadius = UDim.new(0.2, 0)
    sc.Parent = slotBtn
    
    local aspect = Instance.new("UIAspectRatioConstraint")
    aspect.AspectRatio = 1
    aspect.Parent = slotBtn
    
    equipButtons[s.Name] = slotBtn
end

-- 2-3. ë ˆë²¨ & ê³¨ë“œ (ì˜¤ë¥¸ìª½ í•˜ë‹¨)
local statFrame = Instance.new("Frame")
statFrame.Size = UDim2.new(0.38, 0, 0.1, 0)
statFrame.Position = UDim2.new(0.6, 0, 0.76, 0)
statFrame.BackgroundTransparency = 1
statFrame.Parent = mainFrame

local lvlLabel = Instance.new("TextLabel")
lvlLabel.Size = UDim2.new(0.5, 0, 1, 0)
lvlLabel.BackgroundTransparency = 1
lvlLabel.Text = "Lv. " .. myStats.Level
lvlLabel.TextColor3 = Color3.fromRGB(100, 200, 255) 
lvlLabel.Font = Enum.Font.GothamBold
lvlLabel.TextScaled = true
lvlLabel.TextXAlignment = Enum.TextXAlignment.Left
lvlLabel.Parent = statFrame

local goldLabel = Instance.new("TextLabel")
goldLabel.Size = UDim2.new(0.5, 0, 1, 0)
goldLabel.Position = UDim2.new(0.5, 0, 0, 0)
goldLabel.BackgroundTransparency = 1
goldLabel.Text = "G: " .. myStats.Gold
goldLabel.TextColor3 = Color3.fromRGB(255, 220, 0) 
goldLabel.Font = Enum.Font.GothamBold
goldLabel.TextScaled = true
goldLabel.TextXAlignment = Enum.TextXAlignment.Right
goldLabel.Parent = statFrame

-- 2-4. íƒ­ ë²„íŠ¼ ì„¹ì…˜ (ì˜¤ë¥¸ìª½ í•˜ë‹¨)
local tabFrame = Instance.new("Frame")
tabFrame.Size = UDim2.new(0.38, 0, 0.08, 0)
tabFrame.Position = UDim2.new(0.6, 0, 0.88, 0)
tabFrame.BackgroundTransparency = 1
tabFrame.Parent = mainFrame

local tabs = {"ì¸ë²¤", "ìŠ¤íƒ¯", "ì¥ì‹"}
for i, name in ipairs(tabs) do
    local tabBtn = Instance.new("TextButton")
    tabBtn.Size = UDim2.new(0.3, 0, 1, 0)
    tabBtn.Position = UDim2.new(0.35 * (i-1), 0, 0, 0)
    tabBtn.BackgroundColor3 = i==1 and Color3.fromRGB(100, 100, 100) or Color3.fromRGB(60, 60, 60)
    tabBtn.Text = name
    tabBtn.TextColor3 = Color3.new(1,1,1)
    tabBtn.Font = Enum.Font.Gotham
    tabBtn.TextScaled = true
    tabBtn.Parent = tabFrame
    
    local tc = Instance.new("UICorner")
    tc.CornerRadius = UDim.new(0.3, 0)
    tc.Parent = tabBtn
end

-- ==============================================================================
-- [ê¸°ëŠ¥ êµ¬í˜„]
-- ==============================================================================

function refreshEquipment()
    for slotName, btn in pairs(equipButtons) do
        local item = equippedData[slotName]
        
        if item then
            btn.Text = item.icon .. "\n" .. item.name .. "\n(" .. item.stat .. ")"
            btn.BackgroundColor3 = Color3.fromRGB(100, 150, 255) 
        else
            local defaultIcon = ""
            for _, s in ipairs(slots) do 
                if s.Name == slotName then defaultIcon = s.Icon end 
            end
            btn.Text = defaultIcon .. "\n" .. slotName
            btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80) 
        end
    end
end

local function refreshInventory()
    for _, child in pairs(invGrid:GetChildren()) do
        if child:IsA("TextButton") then child:Destroy() end
    end
    
    for i, item in ipairs(inventoryData) do
        local itemBtn = Instance.new("TextButton")
        itemBtn.Name = item.name
        itemBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        itemBtn.Text = item.icon
        itemBtn.TextScaled = true 
        itemBtn.Parent = invGrid
        
        local ic = Instance.new("UICorner"); ic.Parent = itemBtn
        
        -- UIAspectRatioConstraint í•„ìš” ì—†ìŒ (Offsetìœ¼ë¡œ ì •í™•íˆ ë§ì¶¤)
        
        local nameLbl = Instance.new("TextLabel")
        nameLbl.Size = UDim2.new(1,0,0.3,0)
        nameLbl.Position = UDim2.new(0,0,0.7,0)
        nameLbl.BackgroundTransparency = 1
        nameLbl.Text = item.name
        nameLbl.TextColor3 = Color3.new(1,1,1)
        nameLbl.TextScaled = true
        nameLbl.Parent = itemBtn
        
        itemBtn.MouseButton1Click:Connect(function()
            local slotType = item.type
            
            if equippedData[slotType] == nil then
                equippedData[slotType] = item
                table.remove(inventoryData, i) 
                
                print("Equipped: " .. item.name)
                
                refreshInventory()
                refreshEquipment()
            else
                print("âš ï¸ ì´ë¯¸ ì¥ì°©ëœ ì•„ì´í…œì´ ìˆìŠµë‹ˆë‹¤! ë¨¼ì € ì¥ë¹„ë¥¼ í•´ì œí•˜ì„¸ìš”.")
            end
        end)
    end
end

for slotName, btn in pairs(equipButtons) do
    btn.MouseButton1Click:Connect(function()
        local item = equippedData[slotName]
        if item then
            equippedData[slotName] = nil
            table.insert(inventoryData, item) 
            
            print("Unequipped: " .. item.name)
            refreshInventory()
            refreshEquipment()
        end
    end)
end

menuButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
    if mainFrame.Visible then 
        task.wait(0.01) -- ì•„ì£¼ ì ê¹ ëŒ€ê¸° í›„ ê·¸ë¦¬ë“œ ê°±ì‹  (ë Œë”ë§ íƒ€ì´ë° ë¬¸ì œ ë°©ì§€)
        updateGrid() 
    end
end)

refreshInventory()
refreshEquipment()

-- ì´ˆê¸° ì‹¤í–‰
updateGrid()

print("âœ… ë°˜ì‘í˜• ë©”ë‰´ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ")
